# Fletオセロゲーム仕様書

## 1. プロジェクト概要

### 目的
Pythonのクロスプラットフォームフレームワーク「Flet」を使用して、Webブラウザとデスクトップアプリケーションの両方で動作するオセロゲームを開発する。

### 技術スタック
- **言語**: Python 3.11+
- **フレームワーク**: Flet 0.20.0+
- **パッケージ管理**: uv
- **デプロイ**: GitHub Pages（Web版）、ローカルビルド（デスクトップ版）

## 2. ゲーム仕様

### 2.1 基本ルール
1. **ボード**: 8×8のマス目
2. **プレイヤー**: 黒（先手）と白（後手）の2人
3. **初期配置**: 中央4マスに黒白交互に配置
   ```
   □□□□□□□□
   □□□□□□□□
   □□□□□□□□
   □□□●○□□□
   □□□○●□□□
   □□□□□□□□
   □□□□□□□□
   □□□□□□□□
   ```
4. **石の配置**: 相手の石を挟める位置にのみ配置可能
5. **石の反転**: 配置した石と自分の石で挟まれた相手の石を全て反転
6. **パス**: 置ける場所がない場合は自動的にパス
7. **終了条件**: 
   - 全マスが埋まった場合
   - 両プレイヤーとも石を置けない場合
8. **勝敗**: 石の数が多い方が勝利

### 2.2 有効手の判定
石を置ける条件：
- 空きマスである
- 置いた石から8方向（上下左右斜め）のいずれかに相手の石が隣接
- その方向に進んだ先に自分の石が存在
- 間の相手の石を全て反転できる

## 3. 機能要件

### 3.1 必須機能
- **ゲームボード表示**
  - 8×8のグリッド表示
  - 石の表示（黒・白）
  - 有効手のハイライト表示
  
- **ゲーム進行**
  - マウスクリック/タップによる石の配置
  - 自動的な石の反転
  - ターン切り替え
  - パス処理
  
- **情報表示**
  - 現在のターン表示
  - 各プレイヤーの石の数
  - ゲーム終了時の勝敗表示
  
- **ゲーム制御**
  - 新規ゲーム開始
  - ゲームリセット

### 3.2 追加機能
- **AIモード**
  - コンピュータ対戦（難易度：簡単）
  - 評価関数による最適手の計算
  
- **操作性向上**
  - アンドゥ機能（1手戻る）
  - 手番履歴の表示
  
- **UI/UX**
  - レスポンシブデザイン
  - ダークモード/ライトモード切り替え
  - アニメーション効果

## 4. 画面設計

### 4.1 メイン画面構成
```
+----------------------------------+
|          オセロゲーム             |
+----------------------------------+
| [新規ゲーム] [vsAI] [テーマ切替]  |
+----------------------------------+
|  現在のターン: ●黒               |
|  黒: 2  白: 2                    |
+----------------------------------+
|                                  |
|        8×8 ゲームボード          |
|                                  |
+----------------------------------+
| 履歴: 黒D4 → 白E4 → ...          |
+----------------------------------+
```

### 4.2 ゲーム終了画面
- 勝敗表示（「黒の勝利！」「白の勝利！」「引き分け」）
- 最終スコア表示
- 「もう一度プレイ」ボタン

## 5. 技術設計

### 5.1 アーキテクチャ
```
src/
├── main.py              # エントリーポイント
├── game/
│   ├── __init__.py
│   ├── board.py        # ボード管理クラス
│   ├── game.py         # ゲームロジッククラス
│   ├── player.py       # プレイヤークラス
│   └── ai.py          # AI実装
└── ui/
    ├── __init__.py
    ├── board_ui.py     # ボードUIコンポーネント
    ├── controls.py     # コントロールUIコンポーネント
    └── theme.py        # テーマ設定
```

### 5.2 主要クラス設計

#### Board クラス
```python
class Board:
    - grid: list[list[int]]  # 8×8のボード状態
    - place_stone(row, col, player): bool  # 石を配置
    - get_valid_moves(player): list  # 有効手のリスト取得
    - flip_stones(row, col, player): list  # 石を反転
    - count_stones(): dict  # 石の数を数える
```

#### Game クラス
```python
class Game:
    - board: Board  # ボードインスタンス
    - current_player: int  # 現在のプレイヤー
    - history: list  # 手番履歴
    - make_move(row, col): bool  # 手を打つ
    - switch_turn(): void  # ターン切り替え
    - check_game_over(): bool  # ゲーム終了判定
    - get_winner(): int  # 勝者判定
```

#### AI クラス
```python
class AI:
    - difficulty: str  # 難易度
    - evaluate_board(board): int  # 盤面評価
    - get_best_move(board, player): tuple  # 最適手を取得
    - minimax(board, depth, player): int  # ミニマックス法
```

## 6. ビルドとデプロイ

### 6.1 開発環境
```bash
# 環境セットアップ
uv venv
uv pip install -r requirements.txt

# 開発実行
flet run src/main.py

# ホットリロード付き開発
flet run src/main.py --web --port 8000
```

### 6.2 ビルド
```bash
# Web版ビルド
flet build web --project "Othello Game" --description "Flet Othello Game"

# デスクトップ版ビルド（Windows）
flet build windows

# デスクトップ版ビルド（macOS）
flet build macos

# デスクトップ版ビルド（Linux）
flet build linux
```

### 6.3 デプロイ

#### GitHub Pages
1. GitHub Actionsワークフローを設定
2. mainブランチへのpush時に自動ビルド・デプロイ
3. `https://[username].github.io/flet-othello/` でアクセス可能

#### ローカルデプロイ
1. ビルド成果物を`build/web`に生成
2. 任意のWebサーバーでホスティング

## 7. テスト計画

### 7.1 単体テスト
- ボードクラスのテスト
- ゲームロジックのテスト
- AI評価関数のテスト

### 7.2 統合テスト
- ゲームフロー全体のテスト
- UI操作のテスト

### 7.3 動作確認項目
- [ ] 初期配置が正しい
- [ ] 有効手の判定が正しい
- [ ] 石の反転が正しく動作
- [ ] パスが正しく処理される
- [ ] ゲーム終了判定が正しい
- [ ] AIが正しく動作する
- [ ] UIが各プラットフォームで正しく表示される

## 8. スケジュール

1. **Phase 1**: 環境構築とプロジェクトセットアップ
2. **Phase 2**: ゲームロジック実装
3. **Phase 3**: Flet UIの実装
4. **Phase 4**: AI機能の追加
5. **Phase 5**: ビルドとデプロイ設定
6. **Phase 6**: テストと最終調整

## 9. 今後の拡張案

- 難易度選択（AI強化）
- オンライン対戦機能
- リプレイ機能
- 統計情報の保存
- サウンドエフェクト
- カスタムテーマ
- トーナメントモード